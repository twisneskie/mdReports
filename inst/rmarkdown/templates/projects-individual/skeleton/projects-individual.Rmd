---
title: "`r project$projectTitle`"
subtitle: "Project Report"
date: "`r format(Sys.time(), '%d %B, %Y')`"
author: "Generated by: `r Sys.getenv('USERNAME')`"
output: html_document

---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)

```

## Project Abstract
`r dplyr::pull(project, abstract)`

## Data Management Personnel
```{r dm.personnel}
project %>%
  
  tidyr::unnest_wider("projectPersonnel") %>%
  
  dplyr::select(essential_personnel) %>%

  knitr::kable() %>%
  
  kableExtra::kable_styling(full_width = FALSE, position = "left")
```

## All resources

```{r all.resources}
project %>%
  
  tidyr::unnest("data") %>%
  
  dplyr::mutate(hasMetadata = dplyr::if_else(is.na(status), 
                                            "Intitiated", 
                                            "Completed"),
                dataOriginator = dplyr::if_else(dataOriginator == "",
                                                "None assigned",
                                                dataOriginator),
                uri = dplyr::if_else(is.na(uri),
                                     "File Not Archived",
                                     uri)) %>%
  
  dplyr::select(Title = "title",
                "Product Type" = "productType",
                "Has Metadata" = "hasMetadata",
                "Data Originator" = "dataOriginator",
                "File Location" = "uri") %>%
  
  DT::datatable(filter = "top",
                options = list(pageLength = 5,
                               lengthMenu = c(5, 
                                              10, 
                                              15, 
                                              20),
                               scrollX = TRUE,
                               columnDefs = list(list(width = '20%',
                                                      targets = list(1, 4)
                                                      )
                                                 )
                               ),
                autoHideNavigation = getOption("DT.autoHideNavigation",
                                               TRUE),
                width = "10in")

```

## Resources with data dictionaries
```{r data.dictionaries, results='asis'}

dictionaryTable <- project %>%
  
  tidyr::unnest("data")

dictionaryTable <- dplyr::filter(dictionaryTable,
                                 dictionaryTable$dataDictionary != "NULL") %>%
  dplyr::select(Title = "title")

if(nrow(dictionaryTable) > 0) {
  
  dictionaryTable %>%
    
    knitr::kable() %>%
    
    kableExtra::kable_styling(full_width = FALSE, position = "left")
  
} else {

  cat("No data dictionaries created")
}

```

